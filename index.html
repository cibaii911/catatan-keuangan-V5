<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Catatan Keuangan Pribadi</title>
    <!-- SheetJS library untuk ekspor Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        h2 {
            text-align: center;
            color: #333;
            margin-bottom: 25px;
            font-size: 28px;
        }
        
        h3 {
            color: #333;
            margin: 25px 0 15px 0;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .container {
            max-width: 900px;
            margin: auto;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 600;
            font-size: 14px;
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        button {
            width: 100%;
            padding: 14px;
            margin-top: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .saldo-card {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .saldo-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .saldo-amount {
            font-size: 32px;
            font-weight: bold;
        }
        
        table {
            width: 100%;
            margin-top: 20px;
            border-collapse: separate;
            border-spacing: 0;
            overflow: hidden;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
        }
        
        th:first-child {
            border-top-left-radius: 10px;
        }
        
        th:last-child {
            border-top-right-radius: 10px;
        }
        
        td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }
        
        tbody tr {
            transition: background-color 0.2s;
        }
        
        tbody tr:hover {
            background-color: #f8f9ff;
        }
        
        tbody tr:last-child td {
            border-bottom: none;
        }
        
        .jenis-masuk {
            color: #11998e;
            font-weight: 600;
            background: #e6f9f6;
            padding: 5px 12px;
            border-radius: 20px;
            display: inline-block;
        }
        
        .jenis-keluar {
            color: #eb3b5a;
            font-weight: 600;
            background: #ffe6ea;
            padding: 5px 12px;
            border-radius: 20px;
            display: inline-block;
        }
        
        .jumlah-masuk {
            color: #11998e;
            font-weight: 600;
        }
        
        .jumlah-keluar {
            color: #eb3b5a;
            font-weight: 600;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }
        
        .delete-btn {
            background: #eb3b5a;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .delete-btn:hover {
            background: #d63049;
            transform: scale(1.05);
        }

        .status-saldo {
            margin-top: 12px;
            padding: 10px 18px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            text-align: center;
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .status-saldo.boros {
            display: block;
            background: linear-gradient(135deg, #ff6b6b 0%, #eb3b5a 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(235, 59, 90, 0.35);
        }

        .status-saldo.hemat {
            display: block;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(17, 153, 142, 0.35);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-6px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        .storage-info {
            margin-top: 15px;
            padding: 10px 15px;
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            border-radius: 8px;
            font-size: 13px;
            color: #555;
        }

        .storage-info strong {
            color: #667eea;
        }

        .reset-btn {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            background: linear-gradient(135deg, #eb3b5a 0%, #fc5c65 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(235, 59, 90, 0.4);
        }

        .watermark {
            margin-top: 30px;
            padding: 15px;
            text-align: center;
            border-top: 2px solid #f0f0f0;
            color: #999;
            font-size: 13px;
        }

        .watermark-name {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            font-size: 15px;
            letter-spacing: 0.5px;
        }

        .watermark-icon {
            display: inline-block;
            margin: 0 4px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #11998e;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: slideIn 0.3s ease, slideOut 0.3s ease 2.7s;
            opacity: 0;
        }

        .toast.show {
            opacity: 1;
        }

        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(400px); opacity: 0; }
        }

        /* â”€â”€ LAPORAN STYLES â”€â”€ */
        .laporan-section {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9ff;
            border-radius: 15px;
            border: 2px solid #e0e7ff;
        }

        .filter-periode {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .filter-periode select {
            background: white;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .summary-card-label {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .summary-card-value {
            font-size: 24px;
            font-weight: bold;
        }

        .summary-card.pemasukan .summary-card-value {
            color: #11998e;
        }

        .summary-card.pengeluaran .summary-card-value {
            color: #eb3b5a;
        }

        .summary-card.saldo .summary-card-value {
            color: #667eea;
        }

        .export-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .export-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(17, 153, 142, 0.4);
        }

        .export-btn.excel {
            background: linear-gradient(135deg, #1e8449 0%, #27ae60 100%);
        }

        .export-btn.excel:hover {
            box-shadow: 0 5px 20px rgba(39, 174, 96, 0.4);
        }

        .periode-info {
            background: white;
            padding: 12px 18px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
            color: #667eea;
            border: 2px solid #e0e7ff;
        }

        @media (max-width: 768px) {
            .summary-cards {
                grid-template-columns: 1fr;
            }
            
            .filter-periode {
                grid-template-columns: 1fr;
            }
            
            .export-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ’° Catatan Keuangan Pribadi</h2>

    <div class="storage-info">
        ğŸ’¾ <strong>Data otomatis tersimpan</strong> di browser Anda (LocalStorage). Data akan tetap ada meskipun browser ditutup.
    </div>

    <div class="form-group">
        <label>ğŸ“… Tanggal</label>
        <input type="date" id="tanggal">
    </div>

    <div class="form-group">
        <label>ğŸ“ Keterangan</label>
        <input type="text" id="keterangan" placeholder="Masukkan keterangan...">
    </div>
    
    <div class="form-group">
        <label>ğŸ”„ Jenis Transaksi</label>
        <select id="jenis">
            <option value="masuk">ğŸ’µ Pemasukan</option>
            <option value="keluar">ğŸ’¸ Pengeluaran</option>
        </select>
    </div>

    <div class="form-group">
        <label>ğŸ’³ Jumlah</label>
        <input type="number" id="jumlah" placeholder="Masukkan jumlah...">
    </div>

    <button onclick="tambahData()">â• Tambah Transaksi</button>
    <button class="reset-btn" onclick="resetSemua()">ğŸ—‘ï¸ Reset Semua Data</button>

    <div class="saldo-card">
        <div class="saldo-label">Saldo Saat Ini</div>
        <div class="saldo-amount" id="saldo">Rp 0</div>
    </div>
    <div class="status-saldo" id="statusSaldo"></div>

    <table id="tabelWrapper">
        <thead>
            <tr>
                <th>Tanggal</th>
                <th>Keterangan</th>
                <th>Jenis</th>
                <th>Jumlah</th>
                <th>Aksi</th>
            </tr>
        </thead>
        <tbody id="tabelData"></tbody>
    </table>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- SECTION LAPORAN -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="laporan-section">
        <h3>ğŸ“Š Laporan Keuangan</h3>
        
        <div class="filter-periode">
            <div class="form-group">
                <label>ğŸ“† Pilih Periode</label>
                <select id="periodeFilter" onchange="updateLaporan()">
                    <option value="semua">Semua Data</option>
                    <option value="minggu">Minggu Ini</option>
                    <option value="bulan">Bulan Ini</option>
                    <option value="custom">Custom</option>
                </select>
            </div>
            
            <div class="form-group" id="customDateWrapper" style="display: none;">
                <label>ğŸ—“ï¸ Pilih Bulan & Tahun</label>
                <input type="month" id="customMonth" onchange="updateLaporan()">
            </div>
        </div>

        <div class="periode-info" id="periodeInfo">Menampilkan: Semua Data</div>

        <div class="summary-cards">
            <div class="summary-card pemasukan">
                <div class="summary-card-label">ğŸ’µ Total Pemasukan</div>
                <div class="summary-card-value" id="totalPemasukan">Rp 0</div>
            </div>
            
            <div class="summary-card pengeluaran">
                <div class="summary-card-label">ğŸ’¸ Total Pengeluaran</div>
                <div class="summary-card-value" id="totalPengeluaran">Rp 0</div>
            </div>
            
            <div class="summary-card saldo">
                <div class="summary-card-label">ğŸ’° Saldo Periode</div>
                <div class="summary-card-value" id="saldoPeriode">Rp 0</div>
            </div>
        </div>

        <div class="export-buttons">
            <button class="export-btn excel" onclick="exportToExcel()">
                ğŸ“¥ Download Excel (Periode)
            </button>
            <button class="export-btn" onclick="exportToExcel(true)">
                ğŸ“¥ Download Excel (Semua)
            </button>
        </div>
    </div>

    <div class="watermark">
        Created <span class="watermark-icon">by</span> <span class="watermark-name">Kevin Nayaka</span>
    </div>
</div>

<div class="toast" id="toast"></div>

<script>
    let data = [];

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FUNGSI LOCALSTORAGE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function simpanKeLocalStorage() {
        localStorage.setItem('dataKeuangan', JSON.stringify(data));
    }

    function ambilDariLocalStorage() {
        const dataLokal = localStorage.getItem('dataKeuangan');
        if (dataLokal) {
            data = JSON.parse(dataLokal);
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FUNGSI TOAST NOTIFICATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function showToast(message, type = 'success') {
        const toast = document.getElementById('toast');
        toast.innerText = message;
        
        if (type === 'success') {
            toast.style.background = '#11998e';
        } else if (type === 'error') {
            toast.style.background = '#eb3b5a';
        } else if (type === 'warning') {
            toast.style.background = '#f7b731';
        }
        
        toast.classList.add('show');
        
        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FUNGSI FILTER DATA BERDASARKAN PERIODE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function filterDataByPeriode() {
        const periode = document.getElementById('periodeFilter').value;
        const today = new Date();
        let filteredData = [...data];

        if (periode === 'minggu') {
            // Minggu ini (Senin - Minggu)
            const startOfWeek = new Date(today);
            const day = today.getDay();
            const diff = day === 0 ? -6 : 1 - day; // Senin sebagai hari pertama
            startOfWeek.setDate(today.getDate() + diff);
            startOfWeek.setHours(0, 0, 0, 0);

            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            endOfWeek.setHours(23, 59, 59, 999);

            filteredData = data.filter(d => {
                const tanggal = new Date(d.tanggal);
                return tanggal >= startOfWeek && tanggal <= endOfWeek;
            });

        } else if (periode === 'bulan') {
            // Bulan ini
            const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0, 23, 59, 59, 999);

            filteredData = data.filter(d => {
                const tanggal = new Date(d.tanggal);
                return tanggal >= startOfMonth && tanggal <= endOfMonth;
            });

        } else if (periode === 'custom') {
            const customMonth = document.getElementById('customMonth').value;
            if (customMonth) {
                const [year, month] = customMonth.split('-');
                const startOfMonth = new Date(year, month - 1, 1);
                const endOfMonth = new Date(year, month, 0, 23, 59, 59, 999);

                filteredData = data.filter(d => {
                    const tanggal = new Date(d.tanggal);
                    return tanggal >= startOfMonth && tanggal <= endOfMonth;
                });
            }
        }

        return filteredData;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FUNGSI UPDATE LAPORAN
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function updateLaporan() {
        const periode = document.getElementById('periodeFilter').value;
        const customWrapper = document.getElementById('customDateWrapper');
        
        // Show/hide custom date picker
        if (periode === 'custom') {
            customWrapper.style.display = 'block';
        } else {
            customWrapper.style.display = 'none';
        }

        const filteredData = filterDataByPeriode();
        
        let totalPemasukan = 0;
        let totalPengeluaran = 0;

        filteredData.forEach(d => {
            if (d.jenis === 'masuk') {
                totalPemasukan += d.jumlah;
            } else {
                totalPengeluaran += d.jumlah;
            }
        });

        const saldoPeriode = totalPemasukan - totalPengeluaran;

        document.getElementById('totalPemasukan').innerText = 'Rp ' + totalPemasukan.toLocaleString('id-ID');
        document.getElementById('totalPengeluaran').innerText = 'Rp ' + totalPengeluaran.toLocaleString('id-ID');
        document.getElementById('saldoPeriode').innerText = 'Rp ' + saldoPeriode.toLocaleString('id-ID');

        // Update periode info
        const periodeInfo = document.getElementById('periodeInfo');
        const today = new Date();
        
        if (periode === 'minggu') {
            const startOfWeek = new Date(today);
            const day = today.getDay();
            const diff = day === 0 ? -6 : 1 - day;
            startOfWeek.setDate(today.getDate() + diff);
            
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            
            periodeInfo.innerText = `Menampilkan: Minggu Ini (${startOfWeek.toLocaleDateString('id-ID', {day: '2-digit', month: 'short'})} - ${endOfWeek.toLocaleDateString('id-ID', {day: '2-digit', month: 'short', year: 'numeric'})})`;
        } else if (periode === 'bulan') {
            periodeInfo.innerText = `Menampilkan: ${today.toLocaleDateString('id-ID', {month: 'long', year: 'numeric'})}`;
        } else if (periode === 'custom') {
            const customMonth = document.getElementById('customMonth').value;
            if (customMonth) {
                const [year, month] = customMonth.split('-');
                const date = new Date(year, month - 1);
                periodeInfo.innerText = `Menampilkan: ${date.toLocaleDateString('id-ID', {month: 'long', year: 'numeric'})}`;
            } else {
                periodeInfo.innerText = 'Menampilkan: Pilih bulan dan tahun';
            }
        } else {
            periodeInfo.innerText = 'Menampilkan: Semua Data';
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FUNGSI EXPORT TO EXCEL
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function exportToExcel(exportAll = false) {
        const dataToExport = exportAll ? data : filterDataByPeriode();
        
        if (dataToExport.length === 0) {
            showToast('âš ï¸ Tidak ada data untuk diekspor!', 'warning');
            return;
        }

        // Prepare data untuk Excel
        const excelData = dataToExport.map(d => {
            return {
                'Tanggal': new Date(d.tanggal).toLocaleDateString('id-ID', {
                    day: '2-digit',
                    month: 'long',
                    year: 'numeric'
                }),
                'Keterangan': d.keterangan,
                'Jenis': d.jenis === 'masuk' ? 'Pemasukan' : 'Pengeluaran',
                'Jumlah': d.jumlah
            };
        });

        // Hitung total
        let totalPemasukan = 0;
        let totalPengeluaran = 0;
        dataToExport.forEach(d => {
            if (d.jenis === 'masuk') {
                totalPemasukan += d.jumlah;
            } else {
                totalPengeluaran += d.jumlah;
            }
        });
        const saldo = totalPemasukan - totalPengeluaran;

        // Tambahkan baris kosong dan ringkasan
        excelData.push({});
        excelData.push({
            'Tanggal': '',
            'Keterangan': 'RINGKASAN',
            'Jenis': '',
            'Jumlah': ''
        });
        excelData.push({
            'Tanggal': '',
            'Keterangan': 'Total Pemasukan',
            'Jenis': '',
            'Jumlah': totalPemasukan
        });
        excelData.push({
            'Tanggal': '',
            'Keterangan': 'Total Pengeluaran',
            'Jenis': '',
            'Jumlah': totalPengeluaran
        });
        excelData.push({
            'Tanggal': '',
            'Keterangan': 'Saldo',
            'Jenis': '',
            'Jumlah': saldo
        });

        // Create workbook
        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.json_to_sheet(excelData);

        // Set column widths
        ws['!cols'] = [
            { wch: 20 },  // Tanggal
            { wch: 30 },  // Keterangan
            { wch: 15 },  // Jenis
            { wch: 15 }   // Jumlah
        ];

        XLSX.utils.book_append_sheet(wb, ws, 'Laporan Keuangan');

        // Generate filename
        const periode = document.getElementById('periodeFilter').value;
        const today = new Date();
        let filename = 'Laporan-Keuangan';
        
        if (!exportAll) {
            if (periode === 'minggu') {
                filename += `-Minggu-${today.toLocaleDateString('id-ID', {day: '2-digit', month: 'short', year: 'numeric'}).replace(/\s/g, '-')}`;
            } else if (periode === 'bulan') {
                filename += `-${today.toLocaleDateString('id-ID', {month: 'long', year: 'numeric'}).replace(/\s/g, '-')}`;
            } else if (periode === 'custom') {
                const customMonth = document.getElementById('customMonth').value;
                if (customMonth) {
                    const [year, month] = customMonth.split('-');
                    const date = new Date(year, month - 1);
                    filename += `-${date.toLocaleDateString('id-ID', {month: 'long', year: 'numeric'}).replace(/\s/g, '-')}`;
                }
            }
        } else {
            filename += '-Semua-Data';
        }
        
        filename += '.xlsx';

        // Download
        XLSX.writeFile(wb, filename);
        showToast('âœ… File Excel berhasil didownload!', 'success');
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FUNGSI RENDER TABEL
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function render() {
        let tabel = document.getElementById("tabelData");
        tabel.innerHTML = "";
        let saldo = 0;

        if (data.length === 0) {
            tabel.innerHTML = '<tr><td colspan="5" class="empty-state">Belum ada transaksi. Mulai tambahkan data keuangan Anda!</td></tr>';
        } else {
            data.forEach((d, index) => {
                let row = tabel.insertRow();
                
                let cellTanggal = row.insertCell(0);
                cellTanggal.innerText = new Date(d.tanggal).toLocaleDateString('id-ID', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric'
                });
                
                row.insertCell(1).innerText = d.keterangan;
                
                let cellJenis = row.insertCell(2);
                if (d.jenis === "masuk") {
                    cellJenis.innerHTML = '<span class="jenis-masuk">Pemasukan</span>';
                } else {
                    cellJenis.innerHTML = '<span class="jenis-keluar">Pengeluaran</span>';
                }
                
                let cellJumlah = row.insertCell(3);
                let jumlahFormatted = "Rp " + d.jumlah.toLocaleString("id-ID");
                if (d.jenis === "masuk") {
                    cellJumlah.innerHTML = '<span class="jumlah-masuk">+' + jumlahFormatted + '</span>';
                    saldo += d.jumlah;
                } else {
                    cellJumlah.innerHTML = '<span class="jumlah-keluar">-' + jumlahFormatted + '</span>';
                    saldo -= d.jumlah;
                }
                
                let cellAksi = row.insertCell(4);
                cellAksi.innerHTML = '<button class="delete-btn" onclick="hapusData(' + index + ')">ğŸ—‘ï¸</button>';
            });
        }

        document.getElementById("saldo").innerText = "Rp " + saldo.toLocaleString("id-ID");

        let saldoCard = document.querySelector(".saldo-card");
        let statusEl = document.getElementById("statusSaldo");

        if (saldo < 0) {
            saldoCard.style.background = "linear-gradient(135deg, #ff6b6b 0%, #eb3b5a 100%)";
            statusEl.className = "status-saldo boros";
            statusEl.innerText = "âš ï¸ Anda sangat boros!";
        } else if (saldo > 0) {
            saldoCard.style.background = "linear-gradient(135deg, #11998e 0%, #38ef7d 100%)";
            statusEl.className = "status-saldo hemat";
            statusEl.innerText = "âœ… Anda masih hemat!";
        } else {
            saldoCard.style.background = "linear-gradient(135deg, #11998e 0%, #38ef7d 100%)";
            statusEl.className = "status-saldo";
            statusEl.innerText = "";
        }

        // Update laporan juga
        updateLaporan();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FUNGSI TAMBAH DATA
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function tambahData() {
        let tanggal = document.getElementById("tanggal").value;
        let keterangan = document.getElementById("keterangan").value;
        let jenis = document.getElementById("jenis").value;
        let jumlah = parseInt(document.getElementById("jumlah").value);

        if (!tanggal || !keterangan || !jumlah) {
            showToast("âš ï¸ Mohon lengkapi semua data!", "warning");
            return;
        }

        if (jumlah <= 0) {
            showToast("âš ï¸ Jumlah harus lebih dari 0!", "warning");
            return;
        }

        data.push({ tanggal, keterangan, jenis, jumlah });
        simpanKeLocalStorage();
        render();

        document.getElementById("keterangan").value = "";
        document.getElementById("jumlah").value = "";
        document.getElementById("tanggal").value = new Date().toISOString().split('T')[0];

        showToast("âœ… Transaksi berhasil ditambahkan!", "success");
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FUNGSI HAPUS DATA
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function hapusData(index) {
        if (confirm("Yakin ingin menghapus transaksi ini?")) {
            data.splice(index, 1);
            simpanKeLocalStorage();
            render();
            showToast("ğŸ—‘ï¸ Transaksi berhasil dihapus!", "error");
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FUNGSI RESET SEMUA DATA
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function resetSemua() {
        if (confirm("âš ï¸ PERHATIAN!\n\nAnda akan menghapus SEMUA data transaksi.\nTindakan ini tidak dapat dibatalkan!\n\nLanjutkan?")) {
            data = [];
            localStorage.removeItem('dataKeuangan');
            render();
            showToast("ğŸ—‘ï¸ Semua data berhasil dihapus!", "error");
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INISIALISASI
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    window.onload = function() {
        ambilDariLocalStorage();
        document.getElementById("tanggal").value = new Date().toISOString().split('T')[0];
        document.getElementById("customMonth").value = new Date().toISOString().slice(0, 7);
        render();

        if (data.length > 0) {
            showToast("ğŸ’¾ Data berhasil dimuat dari LocalStorage!", "success");
        }
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // KEYBOARD SHORTCUT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    document.addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && document.activeElement.id === 'jumlah') {
            tambahData();
        }
    });
</script>

</body>
</html>
